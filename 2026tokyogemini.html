<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026Êó•Êú¨ÈÅäŸ©(Àä·óúÀã*)Ÿà</title>
    <!-- [CDN ËºâÂÖ•ÂçÄ] -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* È†ÅÈù¢ËºâÂÖ•ÂãïÁï´ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* Èö±ËóèÊç≤Ëª∏ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* È´òÁ¥öÁ¥ôÂºµÁ¥ãÁêÜËàáÈªûÁãÄËÉåÊôØ */
        .grain-overlay::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; opacity: 0.3; background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png"); }
        .dot-grid { background-image: radial-gradient(#D6C5A0 0.5px, transparent 0.5px); background-size: 20px 20px; }
        
        * { -webkit-tap-highlight-color: transparent; outline: none; }
        
        .lucide-icon-wrapper svg { display: inline-block; vertical-align: middle; }
        
        .overlay-backdrop {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* ÂÖßÂÆπÂçÄÂ¢äÈ´òÔºåÈÅøÂÖçË¢´Â∫ïÈÉ® 46px Â∞éË¶ΩÂàóÈÅÆÊìã */
        .content-padding { padding-bottom: 70px; }

        /* Â∫ïÈÉ®Âõ∫ÂÆöÂ∞éË¶ΩÂàóÊ®£Âºè (Ê•µËá¥ÊâÅÂπ≥ 46px) */
        .fixed-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 390px; z-index: 100;
            background: #FFFFFF; display: flex; height: 46px; 
            border-top: 1px solid #EAE3D2; box-shadow: 0 -5px 25px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-[#DED9CE]">
    <div id="root"></div>

    <!-- [‰∏ªÁ®ãÂºèÈÇèËºØÂçÄ] -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. ÂÖ®ÂüüË≥áÊñôÂÆöÁæ© (Á¢∫‰øù‰∏çË¢´ÁúÅÁï•) ---
        const travelers = [
            { id: 'goldfish', name: 'ÈáëÈ≠ö', color: '#8B5E3C', emoji: 'üê†' },
            { id: 'penguin', name: '‰ºÅÈµù', color: '#5D4037', emoji: 'üêß' },
            { id: 'zhi', name: 'ÈòøÊô∫', color: '#A69076', emoji: 'ü¶â' },
            { id: 'spasm', name: 'ÁóôÊî£', color: '#D6C5A0', emoji: '‚ö°' }
        ];

        const dates = [
            { date: '1/15', weekday: 'Êú®', title: 'DAY 1 Íí∞ Â§ßÈò™ÊäµÈÅî ‚Ä¢ Ê¢ÖÁî∞Ë≥ºÁâ© Íí±' },
            { date: '1/16', weekday: 'Èáë', title: 'DAY 2 Íí∞ USJ Áí∞ÁêÉÂΩ±ÂüéÂÜíÈö™ Íí±' },
            { date: '1/17', weekday: 'Âúü', title: 'DAY 3 Íí∞ Â•àËâØÈ§µÈπø ‚Ä¢ ‰∫¨ÈÉΩÊï£Á≠ñ Íí±' },
            { date: '1/18', weekday: 'Êó•', title: 'DAY 4 Íí∞ Â§ßÈò™ ‚û≥ Êù±‰∫¨ÁßªÂãï Íí±' },
            { date: '1/19', weekday: 'Êúà', title: 'DAY 5 Íí∞ ÂØåÂ£´Â±±Ê≤≥Âè£Êπñ‰πãÊó• Íí±' },
            { date: '1/20', weekday: 'ÁÅ´', title: 'DAY 6 Íí∞ Ê†ÇÊ±†ÊªëÈõ™ Day-1 Íí±' },
            { date: '1/21', weekday: 'Ê∞¥', title: 'DAY 7 Íí∞ Ê†ÇÊ±†ÊªëÈõ™ Day-2 Íí±' },
            { date: '1/22', weekday: 'Êú®', title: 'DAY 8 Íí∞ Âπ≥ÂÆâÂõûÂÆ∂ Íí±' },
        ];

        const staysData = [
            { 
                name: 'Apartment Hotel 11 Higashi Umeda', 
                period: '1/15 ‚Äî 1/18', 
                checkIn: '15:00', checkOut: '11:00', 
                distance: 'JR Â§ßÈò™Á´ôÊ≠•Ë°å 12 ÂàÜÈêò', 
                luggage: 'ÂèØ‰ª•ÂØÑÊîæ (ÈúÄËÅØÁµ°)', 
                nearby: 'Lawson„ÄÅLife Ë∂ÖÂ∏Ç„ÄÅÂîêÂêâË®∂Âæ∑',
                note: 'Ëá™Âä©ÂÖ•‰ΩèÂØÜÁ¢ºÈéñÔºåÁîüÊ¥ªÊ©üËÉΩÊ•µ‰Ω≥„ÄÇ' 
            },
            { 
                name: 'Shinjuku sprem', 
                period: '1/18 ‚Äî 1/19', 
                checkIn: '16:00', checkOut: '10:00', 
                distance: 'JR Êñ∞ÂÆøÁ´ôÂçóÂè£Ê≠•Ë°å 10 ÂàÜÈêò', 
                luggage: '‰∏≠Âçà 12:00 ÂæåÊâçÂèØÂØÑÊîæ', 
                nearby: 'FamilyMart„ÄÅÊñ∞ÂÆøÂæ°Ëãë„ÄÅËó•Â¶ùÂ∫ó',
                note: '‰ΩçÊñº 3 Ê®ì (ÁÑ°ÈõªÊ¢Ø)„ÄÇÂØÑÊîæË°åÊùéÊôÇÈñìË´ãÊ∫ñÊôÇ„ÄÇ' 
            },
            { 
                name: 'Sotetsu Fresa Inn ÂñÑÂÖâÂØ∫Âè£', 
                period: '1/19 ‚Äî 1/22', 
                checkIn: '15:00', checkOut: '11:00', 
                distance: 'JR Èï∑ÈáéÁ´ôÊ≠£Â∞çÈù¢Ê≠•Ë°å 2 ÂàÜÈêò', 
                luggage: 'ÂÖ®Â§©ÂèØÂØÑÊîæ', 
                nearby: 'MIDORI ÂïÜÂ†¥„ÄÅ7-11„ÄÅÈï∑ÈáéÂîêÂêâË®∂Âæ∑',
                note: '‰∫§ÈÄöÊ•µ‰æøÂà©ÔºåÈÅéÈ¶¨Ë∑ØÂç≥ÈÅîËªäÁ´ô„ÄÇ' 
            }
        ];

        // ÂçÅÂ§ßÁ•®Âà∏Ë≥áÊñôÂ∫´ (Âê´Á≤æÁ¢∫Â∫ß‰ΩçËàáÂúñÁâá)
        const ticketsData = [
            { id: 'tk1', type: 'Flight', title: 'ÂúãÊ≥∞Ëà™Á©∫ CX564 (Âè∞Âåó‚ÜíÂ§ßÈò™)', date: '1/15 11:15', assignments: { goldfish: { code: 'DGL2ET', seat: 'ÂæÖÈÅ∏' }, penguin: { code: 'DGL2ET', seat: 'ÂæÖÈÅ∏' }, zhi: { code: 'DH5MG7', seat: 'ÂæÖÈÅ∏' }, spasm: { code: 'DH5MG7', seat: 'ÂæÖÈÅ∏' } }, isVJW: true, vjwLink: 'https://www.vjw.digital.go.jp/' },
            { id: 'tk2', type: 'Pass', title: 'ÈóúË•øÂú∞ÂçÄÈêµË∑ØÂë®ÈÅäÂà∏', date: '1/15', isJR: true, details: { no: '40376', card: '1668', notice: 'ÊåÅË≠∑ÁÖßÊñºJRÁ™óÂè£È†òÂèñ\nÈúÄÂÇô‰ø°Áî®Âç°+4Á¢ºÂØÜÁ¢º' } },
            { id: 'tk3', type: 'Ticket', title: 'USJ Êó•Êú¨Áí∞ÁêÉÂΩ±ÂüéÈñÄÁ•®', date: '1/16', assignments: { goldfish: { img: 'https://lh3.googleusercontent.com/d/1OcyV3zuqQkXMTtOerNEoMBuXCuSxAoOK' }, penguin: { img: 'https://lh3.googleusercontent.com/d/1MzFWNFr9lKDFtwg902ziO4-KhLeKRPGL' }, zhi: { img: 'https://lh3.googleusercontent.com/d/1ic2KFekF4jO403KVeLGMmOamFoxVcu7r' }, spasm: { img: 'https://lh3.googleusercontent.com/d/1P82cswIIyvEtvvVFIpb6Lj0sQqKBqyhq' } } },
            { id: 'tk4', type: 'Train', title: 'Êñ∞ÂππÁ∑ö Nozomi (Êñ∞Â§ßÈò™‚ÜíÂìÅÂ∑ù)', date: '1/18 08:30', assignments: { zhi: { seat: '13ËôüËªä 1Ëôü B‰Ωç' }, spasm: { seat: '13ËôüËªä 1Ëôü C‰Ωç' }, penguin: { seat: '13ËôüËªä 1Ëôü D‰Ωç' }, goldfish: { seat: '13ËôüËªä 1Ëôü E‰Ωç' } } },
            { id: 'tk5', type: 'Bus', title: 'È´òÈÄüÂ∑¥Â£´ 1101 (Êñ∞ÂÆø‚ÜíÂØåÂ£´Â±±)', date: '1/19 07:15', details: { no: 'Á∑®Ëôü 1101', notice: 'ÁèæÂ†¥ÂÖ•Â∫ßÔºåÁÑ°ÊåáÂÆöÂ∏≠' } },
            { id: 'tk6', type: 'Bus', title: 'È´òÈÄüÂ∑¥Â£´ 1124 (Ê≤≥Âè£Êπñ‚ÜíÊñ∞ÂÆø)', date: '1/19 16:40', details: { no: 'Á∑®Ëôü 1124', notice: 'ÁèæÂ†¥ÂÖ•Â∫ßÔºåÁÑ°ÊåáÂÆöÂ∏≠' } },
            { id: 'tk7', type: 'Train', title: 'Êñ∞ÂππÁ∑ö Kagayaki 519 (Êù±‰∫¨‚ÜíÈï∑Èáé)', date: '1/19 21:04', assignments: { zhi: { seat: '6ËôüËªä 17Ëôü D‰Ωç' }, spasm: { seat: '6ËôüËªä 17Ëôü E‰Ωç' }, penguin: { seat: '6ËôüËªä 18Ëôü D‰Ωç' }, goldfish: { seat: '6ËôüËªä 18Ëôü E‰Ωç' } } },
            { id: 'tk8', type: 'Train', title: 'Êñ∞ÂππÁ∑ö Kagayaki 504 (Èï∑Èáé‚Üí‰∏äÈáé)', date: '1/22 09:17', assignments: { zhi: { seat: '8ËôüËªä 18Ëôü D‰Ωç' }, spasm: { seat: '8ËôüËªä 18Ëôü E‰Ωç' }, penguin: { seat: '8ËôüËªä 19Ëôü D‰Ωç' }, goldfish: { seat: '8ËôüËªä 19Ëôü E‰Ωç' } } },
            { id: 'tk9', type: 'Ticket', title: 'Skyliner (Êó•ÊöÆÈáå‚ÜíÊàêÁî∞)', date: '1/22 11:05', currentImg: 'https://lh3.googleusercontent.com/d/1TqPXatdp3FU501uBio-4ahi6SJIRKEua' },
            { id: 'tk10', type: 'Flight', title: 'ÂúãÊ≥∞Ëà™Á©∫ CX451 (Êù±‰∫¨‚ÜíÂè∞Âåó)', date: '1/22 15:30', assignments: { goldfish: { code: 'CX451', seat: 'ÂæÖÈÅ∏' }, penguin: { code: 'CX451', seat: 'ÂæÖÈÅ∏' }, zhi: { code: 'CX451', seat: 'ÂæÖÈÅ∏' }, spasm: { code: 'CX451', seat: 'ÂæÖÈÅ∏' } }, note: 'Êù±‰∫¨‰∫åËà™‚ÜíÂè∞Âåó‰∏ÄËà™\nÊ≥¢Èü≥ 777-300' }
        ];

        // ÂÆåÊï¥ 8 Êó•Ë°åÁ®ãÊï∏Êìö (ÊåâÁî®Êà∂Êèê‰æõÈ†ÜÂ∫èÂÆåÊï¥ÈåÑÂÖ•ÔºåÁÑ°ÁúÅÁï•)
        const fullItineraryData = [
            // 1/15 DAY-1
            { dateIndex: 0, startTime: '11:15', name: 'Êê≠‰πòÂúãÊ≥∞Ëà™Á©∫', address: 'Ê°ÉÂúíÊ©üÂ†¥', category: 'Flight', note: '11:15-14:55\nÂè∞Âåó‰∏ÄËà™‚Üí Â§ßÈò™‰∏ÄËà™' },
            { dateIndex: 0, startTime: '16:00', name: 'Âá∫Êµ∑Èóú', address: 'ÈóúË•øÊ©üÂ†¥Á¨¨‰∏ÄËà™Âªà', category: 'MapIcon', note: '' },
            { dateIndex: 0, startTime: '16:30', name: 'Êê≠‰πòJR HARUKAÁâπÊÄ•', address: 'ÈóúË•øÊ©üÂ†¥JR HARUKÁöÑ‰ΩçÁΩÆ', category: 'Transport', note: '‰ΩøÁî®ÈóúË•øÂú∞ÂçÄÈêµË∑ØÂë®ÈÅäÂà∏ Ëá™Áî±Â∏≠' },
            { dateIndex: 0, startTime: '17:20', name: 'Ê¢ÖÁî∞Ë≥ºÁâ©', address: 'JRÊ¢ÖÁî∞', category: 'Shopping', note: '' },
            { dateIndex: 0, startTime: 'ÊôöÈ§ê', name: 'È†êË®àÁáíËÇâËÇâ‰∫îÈÉé', address: 'ËÇâ‰∫îÈÉé', category: 'Food', note: 'ÁáüÊ•≠ÊôÇÈñì11:00-23:00\nJRÂ§ßÈò™Áí∞ÁãÄÁ∑öÂ§©ÊªøÁ´ôÊ≠•Ë°å3ÂàÜÈêò' },
            { dateIndex: 0, startTime: '‰ΩèÂÆø', name: 'Â§ßÈò™‰ΩèËôï', address: 'Apartment Hotel 11 Higashi Umeda', category: 'Hotel', note: '' },
            
            // 1/16 DAY-2
            { dateIndex: 1, startTime: '6:40', name: 'È£ØÂ∫óÂá∫Áôº', address: 'JR Â§ßÈò™Á´ô', category: 'Transport', note: 'Ê≠•Ë°åÁ¥Ñ 12 ÂàÜÈêòËá≥JRÂ§ßÈò™Á´ô\nJRÂ§ßÈò™Á´ô‚ÜíË•ø‰πùÊ¢ùÁ´ô Êê≠‰πò:JRÂ§ßÈò™Áí∞ÁãÄÁ∑ö\nÊó©È§êÈ†êË®àÂêÉ711' },
            { dateIndex: 1, startTime: '7:40', name: 'ÊäµÈÅîÁí∞ÁêÉ', address: 'USJÁí∞ÁêÉÂΩ±Âüé', category: 'Sightseeing', note: 'ÂÖ•ÂúíÁõ¥Ë°ùÈ¶¨ÂäõÊ≠êÂúíÂçÄ\n\n„ÄêÂÖ•ÂúíÈ†àÁü•„Äë\n1.ÊèêÊó©‰∏ãËºâÂÆòÊñπApp‰∏¶ÁôªÈåÑÈñÄÁ•®\n2.ÊäΩÂçÄÂüüÊï¥ÁêÜÂà∏\n3.Á¶ÅÂ∏∂Â§ñÈ£ü' },
            { dateIndex: 1, startTime: '20:00', name: 'ÈñâÂúíÊôÇÈñì', address: 'Ë∂ÖÂ∏Ç', category: 'Food', note: 'ÊôöÈ§êÈ†êË®àÂêÉË∂ÖÂ∏Ç' },
            { dateIndex: 1, startTime: '‰ΩèÂÆø', name: 'Â§ßÈò™‰ΩèËôï', address: 'Apartment Hotel 11 Higashi Umeda', category: 'Hotel', note: '' },

            // 1/17 DAY-3
            { dateIndex: 2, startTime: '7:40', name: 'È£ØÂ∫óÂá∫Áôº', address: 'JR Â§ßÈò™Á´ô', category: 'Transport', note: 'Ê≠•Ë°åÁ¥Ñ 12 ÂàÜÈêòËá≥JRÂ§ßÈò™Á´ô\nÂ§ßÈò™Á´ô‚Üí Â•àËâØÁ´ô Êê≠‰πò:JRÂ§ßÂíåË∑ØÂø´ÈÄü(50min)\nÊó©È§êÈ†êË®àÂêÉ711' },
            { dateIndex: 2, startTime: '8:50', name: 'ÂâçÂæÄÂ•àËâØÂÖ¨Âúí', address: 'JR Â•àËâØÁ´ô', category: 'Transport', note: 'JRÂ•àËâØÁ´ôÊù±Âè£‚Üí„ÄåÂ•àËâØÂÖ¨ÂúíÂâç„Äç Êàñ „ÄåÁúåÂ∫ÅÂâç„Äç ‰∏ãËªä' },
            { dateIndex: 2, startTime: '9:00', name: 'È§µÈπøÊï£Ê≠•', address: 'Â•àËâØÂÖ¨Âúí', category: 'Sightseeing', note: 'È†êË®à10:30ÁµêÊùü\nÂ•àËâØÂÖ¨Âúí‚Üí JRÂ•àËâØÁ´ô(Ëµ∞20min)' },
            { dateIndex: 2, startTime: '11:00', name: 'ÂâçÂæÄ‰∫¨ÈÉΩ', address: 'JR Â•àËâØÁ´ô', category: 'Transport', note: 'JRÂ•àËâØÁ´ô‚Üí JR‰∫¨ÈÉΩÁ´ô Êê≠‰πò:JR Â•àËâØÁ∑öÂø´ÈÄü(45min)' },
            { dateIndex: 2, startTime: '12:00', name: 'Èå¶Â∏ÇÂ†¥ÂêÉÂçàÈ§ê', address: 'Èå¶Â∏ÇÂ†¥', category: 'Food', note: '‰∫¨ÈÉΩÁ´ô‚Üí ÂõõÊù°Á´ô Êê≠‰πò:‰∫¨ÈÉΩÂ∏ÇÁáüÂú∞‰∏ãÈêµÁÉè‰∏∏Á∑ö(4min)\nÂõõÊù°Á´ô‚Üí Èå¶Â∏ÇÂ†¥(Ëµ∞5min)' },
            { dateIndex: 2, startTime: '13:30', name: 'ÈÄõË°ó', address: '‰∫åÂπ¥ÂùÇ ‰∏âÂπ¥ÂùÇ', category: 'Shopping', note: 'Ëä±Ë¶ãÂ∞èË∑Ø„ÄÅ‰∫åÂπ¥ÂùÇ ‰∏âÂπ¥ÂùÇ Êï£Ê≠•\nÈ†êË®à18:20Èõ¢Èñã' },
            { dateIndex: 2, startTime: '19:00', name: 'ÂÖ≠ËßíACE', address: 'ÂÖ≠ËßíACE', category: 'Food', note: '‚úßÁÉè‰∏∏Âæ°Ê±†Á´ô 5ËôüÂá∫Âè£Â∑¶ËΩâÔºåÊ≠•Ë°å10min ‚∏ù‚∏ù‚úß17:00-23:00\n‚ú©‚Äîace„ÅÆ„Éù„ÉÜ„Çµ„É© 580ÂÜÜ (Á≥ñÂøÉËõãÈ¶¨Èà¥ËñØ)\n‚ú©‚Äî„Éè„É©„Éü„Çπ„ÉÜ„Éº„Ç≠ 1180ÂÜÜ (Ë£ôÂ≠êÁâõÊéí)\n‚ú©‚Äî„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó„ÅÆÂîêÊèö 600ÂÜÜ (ÁÇ∏ÁéâÁ±≥)\n‚ú©‚Äî„Ç≠„Ç¶„Ç§„Çµ„ÉØ„Éº 580ÂÜÜ (Â•áÁï∞ÊûúÊ≤ôÁì¶)' },
            { dateIndex: 2, startTime: '20:30', name: 'ÂõûÊ¢ÖÁî∞', address: 'JR ‰∫¨ÈÉΩÁ´ô', category: 'Transport', note: '‰∫¨ÈÉΩ ‚Üí Ê¢ÖÁî∞ Êê≠‰πò:JR ‰∫¨ÈÉΩÁ∑öÔºàÊñ∞Âø´ÈÄüÔºâ(30min)' },
            { dateIndex: 2, startTime: '‰ΩèÂÆø', name: 'Â§ßÈò™‰ΩèËôï', address: 'Apartment Hotel 11 Higashi Umeda', category: 'Hotel', note: '‰ªäÂ§©Ë¶ÅÊï¥ÁêÜË°åÊùéÂï¶' },

            // 1/18 DAY-4
            { dateIndex: 3, startTime: '8:00', name: 'È£ØÂ∫óÂá∫Áôº(Â∏∂Ë°åÊùé)', address: 'Êñ∞Â§ßÈò™Á´ô', category: 'Transport', note: '08:30Êñ∞Â§ßÈò™‚Üí 10:49ÂìÅÂ∑ù Êê≠‰πò:Êù±Êµ∑ÈÅìÊñ∞ÂππÁ∑ö Nozomi 13ËôüËªä\nÂìÅÂ∑ù ‚Üí Êñ∞ÂÆø Êê≠‰πò:Â±±ÊâãÁ∑ö ÊñºÂåóËΩâ‰πòÂè£ 2ËôüÊúàÂè∞' },
            { dateIndex: 3, startTime: '12:00', name: 'ÂØÑÊîæË°åÊùé', address: 'Shinjuku sprem', category: 'Hotel', note: 'ÂÖàÂõûÈ£ØÂ∫óÂØÑÊîæË°åÊùé Ëµ∞Ë∑Ø10min' },
            { dateIndex: 3, startTime: 'ÂçàÈ§ê', name: 'ËàáÁæéÂÑ™ÂêÉÈ£Ø', address: 'Âú∞ÈªûÂ∞öÊú™Ê±∫ÂÆö', category: 'Food', note: 'Ê±∫ÂÆöÂ•ΩÂú®Êâì‰∏ä‰æÜ' },
            { dateIndex: 3, startTime: 'ÊôöÈ§ê', name: 'Â∞öÊú™Ê±∫ÂÆö', address: 'Âú∞ÈªûÂ∞öÊú™Ê±∫ÂÆö', category: 'Food', note: 'Ê±∫ÂÆöÂ•ΩÂú®Êâì‰∏ä‰æÜ' },
            { dateIndex: 3, startTime: '‰ΩèÂÆø', name: 'Êñ∞ÂÆø‰ΩèËôï', address: 'Shinjuku sprem', category: 'Hotel', note: 'Ê®ìÂ±§3Ê®ì\n‰ªäÂ§©Ë¶ÅÊó©Áù°+Êï¥ÁêÜË°åÊùé' },

            // 1/19 DAY-5
            { dateIndex: 4, startTime: '6:50', name: 'Âá∫ÁôºÊê≠Â∑¥Â£´', address: 'Êñ∞ÂÆøÂ∑¥Â£´Á∏ΩÁ´ô', category: 'Transport', note: '07:15Êñ∞ÂÆøÂ∑¥Â£´Á∏ΩÁ´ô‚Üí 09:07ÂØåÂ£´Â±±ÈßÖ Êê≠‰πò:È´òÈÄüÂ∑¥Â£´ Á∑®Ëôü1101\nÂØåÂ£´Â±±ÈßÖ ‚Üí‰∏ãÂêâÁî∞ÈßÖ Êê≠‰πò: Ë®àÁ®ãËªä ¬•1,200 (8ÂàÜÈêò)' },
            { dateIndex: 4, startTime: '9:20', name: '‰∏ãÂêâÁî∞ Êú¨Áî∫ÈÄö', address: 'Êú¨Áî∫ÈÄö', category: 'Sightseeing', note: 'ÊãçÂØåÂ£´Â±±Ë°óÊôØ\nÂêëÊñ∞ÂÄâÂ±±Ê∑∫ÈñìÂÖ¨ÂúíËµ∞Âéª' },
            { dateIndex: 4, startTime: '10:00', name: 'Êñ∞ÂÄâÂ±±Ê∑∫ÈñìÂÖ¨Âúí', address: 'Âø†ÈùàÂ°î', category: 'Sightseeing', note: 'Ë¶ÅÁà¨80Â±§Ê®ìÊ¢Ø\nÊú±Âç∞Ë≥áË®äÁ®çÂæåÊâì‰∏ä' },
            { dateIndex: 4, startTime: 'ÂçàÈ§ê', name: 'Êú¨Áî∫ÈÄöÂë®ÈÇäÊº´Ê≠•', address: 'Êú¨Áî∫ÈÄöÂÆö', category: 'Food', note: 'Âà∞ËôïÂêÉÂêÉÈÄõÈÄõ\nÊé®Ëñ¶ÁæéÈ£üÁ®çÂæåÊâì‰∏ä' },
            { dateIndex: 4, startTime: '12:30', name: 'ÂâçÂæÄÊ≤≥Âè£Êπñ', address: '‰∏ãÂêâÁî∞Á´ô', category: 'Transport', note: '‰∏ãÂêâÁî∞ ‚ÜíÊ≤≥Âè£ÊπñÁ´ô Êê≠‰πò:ÂØåÂ£´ÊÄ•Ë°åÁ∑ö' },
            { dateIndex: 4, startTime: '13:00', name: 'ÂØåÂ£´Â±±ÂÖ®ÊôØÁ∫úËªä', address: 'ÂØåÂ£´Â±±ÂÖ®ÊôØÁ∫úËªä', category: 'Sightseeing', note: 'Á¢∫‰øùÂú®Êó•ËêΩÂâçËÉΩÂÆåÊàêÁ∫úËªäÂíåÂ±±È†ÇËßÄÊôØÔºåÈÅøÂÖçÂ±±È´îË¢´ÈÄÜÂÖâÈô∞ÂΩ±ÈÅÆÊìã„ÄÇ' },
            { dateIndex: 4, startTime: '16:20', name: 'ÂâçÂæÄÊ≤≥Âè£ÊπñÂ∑¥Â£´Á´ô', address: 'Ê≤≥Âè£ÊπñÂ∑¥Â£´Á´ô', category: 'Transport', note: '16:40Ê≤≥Âè£ÊπñÈßÖ ‚Üí18:25Êñ∞ÂÆøÂ∑¥Â£´Á∏ΩÁ´ô Êê≠‰πò:È´òÈÄüÂ∑¥Â£´ Á∑®Ëôü1124' },
            { dateIndex: 4, startTime: '18:40', name: 'È†òË°åÊùé&ÂêÉÊôöÈ§ê', address: 'Shinjuku sprem', category: 'Food', note: 'ÂõûÈ£ØÂ∫óÈ†òË°åÊùé„ÄÅÂêÉÁ∞°ÂñÆÊôöÈ§ê(Ëã•ËºÉË∂ïÁöÑË©±ÊôöÈ§êË≤∑ÂéªËªä‰∏äÂêÉ)' },
            { dateIndex: 4, startTime: '20:30', name: 'ËΩâÈªûÊù±‰∫¨ËªäÁ´ô', address: 'Êñ∞ÂÆøÁ´ô', category: 'Transport', note: 'Êñ∞ÂÆø‚ÜíÊù±‰∫¨ Êê≠‰πò:JR ‰∏≠Â§ÆÁ∑öÂø´ÈÄü' },
            { dateIndex: 4, startTime: '21:00', name: 'Êê≠ÂéªÈï∑Èáé', address: 'Êù±‰∫¨Á´ô', category: 'Transport', note: '21:04Êù±‰∫¨Tokyo‚Üí 22:23Èï∑ÈáéNagano Êê≠‰πò:Kagayaki 519' },
            { dateIndex: 4, startTime: '‰ΩèÂÆø', name: 'Èï∑Èáé‰ΩèËôï', address: 'Sotetsu Fresa Inn', category: 'Hotel', note: 'ÂñÑÂÖâÂØ∫Âè£ Ê≠•Ë°åÁ¥Ñ 2 ÂàÜÈêò' },

            // 1/20 DAY-6
            { dateIndex: 5, startTime: '8:00', name: 'È£ØÂ∫óÂá∫ÁôºÁßüËªä', address: 'Toyota Rent-A-Car', category: 'Transport', note: 'Ëµ∞Ë∑Ø15ÂàÜÈêò\nÁßüËªäÊ≥®ÊÑè‰∫ãÈ†Ö' },
            { dateIndex: 5, startTime: '8:40', name: 'Ëá™ÈßïËá≥Ê†ÇÊ±†È´òÂéüÊªëÈõ™Â†¥', address: 'Ê†ÇÊ±†È´òÂéüÊªëÈõ™Â†¥', category: 'Sightseeing', note: 'Êó•ÈñìÊªëÈõ™ 08:00 Ëá≥ 17:00' },
            { dateIndex: 5, startTime: 'ÊôöÈ§ê', name: 'Â∞öÊú™Ê±∫ÂÆö', address: 'Âú∞ÈªûÂ∞öÊú™Ê±∫ÂÆö', category: 'Food', note: 'Ê±∫ÂÆöÂ•ΩÂú®Êâì‰∏ä‰æÜ' },
            { dateIndex: 5, startTime: '‰ΩèÂÆø', name: 'Èï∑Èáé‰ΩèËôï', address: 'Sotetsu Fresa Inn', category: 'Hotel', note: 'ÂñÑÂÖâÂØ∫Âè£ Ê≠•Ë°åÁ¥Ñ 2 ÂàÜÈêò' },

            // 1/21 DAY-7
            { dateIndex: 6, startTime: '8:00', name: 'Ëá™ÈßïËá≥Ê†ÇÊ±†È´òÂéüÊªëÈõ™Â†¥', address: 'Ê†ÇÊ±†È´òÂéüÊªëÈõ™Â†¥', category: 'Sightseeing', note: 'Êó•ÈñìÊªëÈõ™ 08:00 Ëá≥ 17:00' },
            { dateIndex: 6, startTime: 'ÂçàÈ§ê', name: 'Â∞öÊú™Ê±∫ÂÆö', address: 'Ê†ÇÊ±†È´òÂéüÊªëÈõ™Â†¥', category: 'Food', note: 'Ê±∫ÂÆöÂ•ΩÂú®Êâì‰∏ä‰æÜ' },
            { dateIndex: 6, startTime: '20:00', name: 'ÈÇÑËªä', address: 'Toyota Rent-A-Car', category: 'Transport', note: 'Ë¶ÅË®òÂæóÂä†ÊªøÊ≤π' },
            { dateIndex: 6, startTime: 'ÊôöÈ§ê', name: 'Â∞öÊú™Ê±∫ÂÆö', address: 'Âú∞ÈªûÂ∞öÊú™Ê±∫ÂÆö', category: 'Food', note: 'Ê±∫ÂÆöÂ•ΩÂú®Êâì‰∏ä‰æÜ' },
            { dateIndex: 6, startTime: '‰ΩèÂÆø', name: 'Èï∑Èáé‰ΩèËôï', address: 'Sotetsu Fresa Inn', category: 'Hotel', note: 'ÂñÑÂÖâÂØ∫Âè£ Ê≠•Ë°åÁ¥Ñ 2 ÂàÜÈêò\n‰ªäÂ§©Ë¶ÅÊï¥ÁêÜË°åÊùé' },

            // 1/22 DAY-8
            { dateIndex: 7, startTime: '9:00', name: 'JRÈï∑ÈáéÊê≠Ëªä', address: 'JRÈï∑ÈáéÁ´ô', category: 'Transport', note: '09:17Èï∑ÈáéNagano‚Üí10:31‰∏äÈáéUeno Êê≠‰πò:Kagayaki 504' },
            { dateIndex: 7, startTime: '10:45', name: 'Êó•ÊöÆÈáåËΩâ‰πò', address: 'JR‰∏äÈáé', category: 'Transport', note: '10:47 JR‰∏äÈáéUeno‚Üí 10:50 JRÊó•ÊöÆÈáåNippori' },
            { dateIndex: 7, startTime: '11:05', name: 'ÂâçÂæÄÊàêÁî∞Ê©üÂ†¥', address: 'JRÊó•ÊöÆÈáå', category: 'Transport', note: 'Êó•ÊöÆÈáåNippori ‚Üí ÊàêÁî∞Ê©üÂ†¥ Êê≠‰πò:Skyliner\nÈ†òÁ•®ËôïÔºöÊó•ÊöÆÈáåÁ´ô Skyliner Â∞àÁî®Á™óÂè£' },
            { dateIndex: 7, startTime: '12:30', name: 'ÊàêÁî∞Ê©üÂ†¥ÈÄõ‰º¥ÊâãÁ¶Æ', address: 'ÊàêÁî∞Ê©üÂ†¥', category: 'Shopping', note: 'È†êË®à13:30ÈÅéÊµ∑Èóú' },
            { dateIndex: 7, startTime: '‰ΩèÂÆø', name: 'Âπ≥ÂÆâÂõûÂúã', address: 'Âè∞Âåó', category: 'Hotel', note: 'Êï¥ÁêÜË°åÊùé' },
            { dateIndex: 7, startTime: '15:30', name: 'Êê≠‰πòÂúãÊ≥∞Ëà™Á©∫', address: 'Êù±‰∫¨Ê©üÂ†¥', category: 'Flight', note: '15:30-18:40\nÊù±‰∫¨‰∫åËà™‚Üí Âè∞Âåó‰∏ÄËà™\nÂúãÊ≥∞CX451 Ê≥¢Èü≥ 777-300' }
        ];

        const couponData = [
            { id: 101, name: 'ÂîêÂêâË®∂Âæ∑ Donki', discount: '10% ÂÖçÁ®Ö + 5% ÊäòÊâ£', img: 'https://images.unsplash.com/photo-1596464716127-f2a82984de30?q=80&w=800' },
            { id: 201, name: 'ÊùæÊú¨Ê∏Ö Ëó•Â¶ù', discount: 'ÊúÄÂ§ß 7% ÊäòÊâ£ (Âê´ÂÖçÁ®Ö)', img: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=800' }
        ];

        const accIcons = { 'ÁæéÈ£ü': 'üç∞', '‰∫§ÈÄö': 'üöå', 'Ë∂ÖÂïÜ': 'üçô', 'Á•®Âà∏': 'üéüÔ∏è', 'ÂÖ∂‰ªñ': 'üß∏', 'Âü∫Èáë': 'üí∞', 'ÁΩ∞Ê¨æ': 'üé∞' };

        // --- 2. ËºîÂä©ÁµÑ‰ª∂ ---
        const FujiIllustration = () => (
            <svg viewBox="0 0 200 100" className="w-14 h-auto opacity-20 text-[#8B5E3C]">
                <path d="M20,90 L100,20 L180,90 Z" fill="currentColor" />
                <path d="M80,37 L100,20 L120,37 Q100,45 80,37" fill="#FFFFFF" />
                <circle cx="160" cy="30" r="8" fill="#D6C5A0" />
            </svg>
        );

        const Icon = ({ name, size = 16, className = "" }) => {
            const [svgHtml, setSvgHtml] = useState("");
            useEffect(() => {
                let mounted = true;
                const renderIcon = () => {
                    if (!window.lucide || !window.lucide.icons) { setTimeout(renderIcon, 50); return; }
                    const iconMap = { "Flight": "plane", "MapIcon": "map", "ImageIcon": "image", "Transport": "train", "Sightseeing": "star", "Food": "utensils", "Shopping": "shopping-bag", "Layout": "layout", "Ticket": "ticket", "Wallet": "wallet", "Hotel": "hotel", "Bus": "bus", "MapPin": "map-pin", "Clock": "clock", "Package": "package" };
                    const actualName = iconMap[name] || name;
                    const kebabName = actualName.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    const iconObj = window.lucide.icons[actualName] || window.lucide.icons[kebabName];
                    if (iconObj && typeof iconObj.toSvg === 'function' && mounted) { setSvgHtml(iconObj.toSvg({ width: size, height: size, class: className, 'stroke-width': 2 })); }
                };
                renderIcon(); return () => { mounted = false; };
            }, [name, size, className]);
            return <span className="lucide-icon-wrapper flex items-center justify-center shrink-0" dangerouslySetInnerHTML={{ __html: svgHtml }} />;
        };

        const getMockWeather = (dateStr) => {
            const day = parseInt(dateStr.split('/')[1]);
            const color = "text-[#5D4037]"; 
            if (day <= 17) return { icon: <span className={`${color} text-xl font-bold`}>‚òÄ</span>, temp: '8¬∞C' };
            if (day === 18) return { icon: <span className={`${color} text-xl`}>‚òÅ</span>, temp: '6¬∞C' };
            if (day === 19) return { icon: <span className={`${color} text-xl font-black`}>‚ò∏</span>, temp: '4¬∞C' };
            return { icon: <span className={`${color} text-xl font-bold`}>‚ùÜ</span>, temp: '-2¬∞C' };
        };

        // --- ÊéíÂ∫èÈÇèËºØ‰øÆÊ≠£ (ËôïÁêÜ 8:00 Ëàá 10:00 ÁöÑÂ§ßÂ∞èÈóú‰øÇ) ---
        const sortedDayTrips = (dayItems) => {
            return [...dayItems].sort((a, b) => {
                const getWeight = (t) => { 
                    if (t === 'ÂçàÈ§ê') return '12:00';
                    if (t === 'ÊôöÈ§ê') return '23:58'; 
                    if (t === '‰ΩèÂÆø') return '23:59'; 
                    if (!t) return '00:00';
                    // Â¶ÇÊûúÊòØÊôÇÈñìÊ†ºÂºè 8:00 ËΩâÁÇ∫ 08:00
                    if (t.includes(':')) {
                        const parts = t.split(':');
                        return parts[0].padStart(2, '0') + ':' + parts[1];
                    }
                    return t; 
                };
                return getWeight(a.startTime).localeCompare(getWeight(b.startTime));
            });
        };

        // --- 3. App ÁµÑ‰ª∂ ---
        const App = () => {
            const [currentTab, setCurrentTab] = useState('itinerary');
            const [activeTraveler, setActiveTraveler] = useState(travelers[0]);
            const [expandedDateIndex, setExpandedDateIndex] = useState(null);
            const [selectedOverlay, setSelectedOverlay] = useState(null);
            
            const [expenses, setExpenses] = useState(() => {
                const saved = localStorage.getItem('expenses_local_v5');
                return saved ? JSON.parse(saved) : [];
            });
            const [shoppingItems, setShoppingItems] = useState(() => {
                const saved = localStorage.getItem('shopping_local_v5');
                return saved ? JSON.parse(saved) : [];
            });

            useEffect(() => { localStorage.setItem('expenses_local_v5', JSON.stringify(expenses)); }, [expenses]);
            useEffect(() => { localStorage.setItem('shopping_local_v5', JSON.stringify(shoppingItems)); }, [shoppingItems]);

            const [selectedAccDate, setSelectedAccDate] = useState('1/15');
            const [expRawAmount, setExpRawAmount] = useState('');
            const [expDesc, setExpDesc] = useState('');
            const [expType, setExpType] = useState('expense');
            const [expCategory, setExpCategory] = useState('ÁæéÈ£ü');
            const [activeShopCategory, setActiveShopCategory] = useState('Ë∂ÖÂ∏Ç');
            const [newShopItemName, setNewShopItemName] = useState('');

            const closeOverlay = (e) => {
                if (e.target.closest('button') || e.target.closest('a') || e.target.closest('input')) return;
                setSelectedOverlay(null);
            };

            const handleAddExpense = (e) => {
                e.preventDefault();
                if (!expDesc.trim()) return;
                const sanitized = expRawAmount.replace(/[^-+*/().0-9]/g, '');
                let amount = 0; try { amount = new Function(`return ${sanitized}`)() || 0; } catch (err) {}
                const newItem = { id: Date.now(), amount, description: expDesc, type: expType, category: expCategory, date: selectedAccDate, payer: activeTraveler.name, createdAt: new Date().toISOString() };
                setExpenses([newItem, ...expenses]);
                setExpRawAmount(''); setExpDesc('');
            };

            const deleteExpense = (id) => { setExpenses(expenses.filter(e => e.id !== id)); };

            const handleAddShopItem = (e) => {
                e.preventDefault();
                if (!newShopItemName.trim()) return;
                const newItem = { id: Date.now(), name: newShopItemName, category: activeShopCategory, travelerId: activeTraveler.id, purchased: false, createdAt: new Date().toISOString() };
                setShoppingItems([...shoppingItems, newItem]);
                setNewShopItemName('');
            };

            const togglePurchased = (item) => {
                setShoppingItems(shoppingItems.map(si => si.id === item.id ? { ...si, purchased: !si.purchased } : si));
            };

            const deleteShopItem = (id) => { setShoppingItems(shoppingItems.filter(si => si.id !== id)); };

            const financeStats = (() => {
                const dayEntries = expenses.filter(e => e.date === selectedAccDate);
                const inc = dayEntries.filter(e => e.type === 'income').reduce((s, e) => s + Number(e.amount), 0);
                const exp = dayEntries.filter(e => e.type === 'expense').reduce((s, e) => s + Number(e.amount), 0);
                let cumulative = expenses.reduce((s, e) => s + (e.type === 'income' ? Number(e.amount) : -Number(e.amount)), 0);
                return { inc, exp, cumulative };
            })();

            const NavIconButton = ({ active, onClick, icon, label }) => (
                <button onClick={onClick} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${active ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                    <Icon name={icon} size={18} className={`transition-transform duration-300 ${active ? 'scale-150' : 'scale-100 opacity-70'}`} />
                    <span className="text-[8px] font-bold uppercase mt-0.5">{label}</span>
                </button>
            );

            return (
                <div className="flex justify-center bg-[#DED9CE] min-h-screen font-sans selection:bg-[#5D4037]/10">
                    <div className="w-full max-w-[390px] min-h-screen bg-[#F5F2E9] shadow-2xl relative overflow-hidden flex flex-col grain-overlay text-[#4A3728]">
                        <div className="absolute inset-0 pointer-events-none opacity-[0.02] dot-grid z-0"></div>

                        <div className="flex-1 overflow-y-auto no-scrollbar relative z-10 content-padding">
                            <header className="pt-8 pb-4 px-6 shrink-0 border-b border-[#EAE3D2]/50 text-[#4A3728]">
                                <div className="flex justify-between items-center">
                                    <h1 className="text-2xl font-bold tracking-tighter leading-none">Êó•Êú¨ÊóÖË°åÊâãË®ò</h1>
                                    <div className="flex gap-1.5">
                                        {travelers.map(t => (
                                            <button key={t.id} onClick={() => setActiveTraveler(t)} className={`w-7 h-7 rounded-full border flex items-center justify-center transition-all duration-500 ${activeTraveler.id === t.id ? 'border-[#5D4037] scale-110 shadow-md ring-2 ring-[#5D4037]/10 z-10' : 'border-white/50 opacity-40 scale-90'}`} style={{ backgroundColor: t.color }}>
                                                <span className="text-[10px]">{t.emoji}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="mt-3 flex justify-between items-end opacity-50">
                                    <FujiIllustration />
                                    <div className="flex items-center gap-1 bg-[#FAF9F6] px-2 py-0.5 rounded-full border border-[#EAE3D2]">
                                        <div className="w-1 h-1 rounded-full animate-pulse" style={{ backgroundColor: activeTraveler.color }}></div>
                                        <span className="text-[7px] font-bold text-[#8C7B68] uppercase tracking-widest">{activeTraveler.name} Ë¶ñËßí</span>
                                    </div>
                                </div>
                            </header>

                            <main className="px-5 pt-2 animate-fade-in text-[#4A3728]">
                                {/* 1. Ë°åÁ®ãÂàÜÈ†Å */}
                                {currentTab === 'itinerary' && (
                                    <div className="space-y-3 pt-2 text-[#4A3728]">
                                        {dates.map((d, i) => {
                                            const isExpanded = expandedDateIndex === i;
                                            return (
                                                <div key={i} className="bg-white border rounded-xl shadow-sm overflow-hidden border-[#EAE3D2]">
                                                    <button onClick={() => setExpandedDateIndex(isExpanded ? null : i)} className="w-full p-3.5 flex items-center gap-4 text-left">
                                                        <div className={`w-11 h-11 bg-[#5D4037] flex flex-col items-center justify-center rounded-lg shadow-sm`}>
                                                            <span className="text-[7px] font-black text-white/50">{d.weekday}</span>
                                                            <span className="text-base font-bold text-white tracking-tighter">{d.date.split('/')[1]}</span>
                                                        </div>
                                                        <div className="flex-1 font-bold text-[13px]">{d.title}</div>
                                                        <div className="flex flex-col items-end border-l pl-3 border-[#F3EFE0]">
                                                            {getMockWeather(d.date).icon}<span className="text-[10px] font-bold text-[#5D4037]">{getMockWeather(d.date).temp}</span>
                                                        </div>
                                                    </button>
                                                    {isExpanded && (
                                                        <div className="px-5 pb-5 space-y-4 border-t pt-4 animate-fade-in text-[#4A3728]">
                                                            {sortedDayTrips(fullItineraryData.filter(t => t.dateIndex === i)).map((trip, idx) => (
                                                                <div key={idx} className="flex gap-4">
                                                                    <span className="text-[9px] font-black py-1 h-5 min-w-[38px] bg-[#FAF9F6] border border-[#EAE3D2] text-center rounded shadow-xs text-[#4A3728]">{trip.startTime}</span>
                                                                    <div className="flex-1 text-[#4A3728]">
                                                                        <div className="flex items-center gap-2 mb-1"><Icon name={trip.category} size={12} className="text-[#D6C5A0]" /><p className="text-[11px] font-bold">{trip.name}</p></div>
                                                                        <p className="text-[8px] opacity-40 uppercase truncate font-black tracking-tight text-[#4A3728]"><Icon name="MapPin" size={7}/> {trip.address}</p>
                                                                        {trip.note && <p className="text-[10px] text-[#8E7D6A] bg-[#FAF9F6] p-2 border-l-2 border-[#D6C5A0] mt-2 whitespace-pre-wrap leading-relaxed shadow-inner font-medium text-[#8E7D6A]">{trip.note}</p>}
                                                                        <button onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(trip.address)}`)} className="mt-2 text-[8px] font-black uppercase text-[#5D4037] flex items-center gap-1.5 underline">Êô∫ÊÖßÂ∞éËà™</button>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}

                                {/* 2. Á•®Âà∏ÂàÜÈ†Å */}
                                {currentTab === 'tickets' && (
                                    <div className="space-y-4 pb-10 px-1 pt-2 animate-fade-in text-[#4A3728]">
                                        {ticketsData.map((tk, i) => {
                                            const my = tk.assignments ? tk.assignments[activeTraveler.id] : null;
                                            return (
                                                <button key={i} onClick={() => setSelectedOverlay({ ...tk, currentImg: my?.img || tk.currentImg })} className="w-full text-left active:scale-[0.98] transition-all">
                                                    <div className={`bg-white border shadow-xl rounded-2xl overflow-hidden relative ${tk.type === 'Flight' ? 'pt-0 border-[#5D4037]/20' : 'p-5 border-[#EAE3D2]'}`}>
                                                        {tk.type === 'Flight' ? (
                                                            <>
                                                                <div className="bg-[#5D4037] p-3 text-white flex justify-between items-center text-[8px] font-bold uppercase tracking-widest text-white">
                                                                    <div className="flex items-center gap-2 text-white"><Icon name="Plane" size={10}/> Boarding Pass</div>
                                                                    <span className="text-white">Cathay Pacific</span>
                                                                </div>
                                                                <div className="p-5 text-[#4A3728]">
                                                                    <div className="flex justify-between items-end mb-4 text-[#4A3728]">
                                                                        <div><p className="text-[7px] font-black opacity-30 uppercase tracking-widest text-[#A69076]">Passenger</p><p className="text-sm font-black text-[#4A3728]">{activeTraveler.name}</p></div>
                                                                        <div className="text-right"><p className="text-[7px] font-black opacity-30 text-[#A69076]">Seat</p><p className="text-sm font-black text-[#5D4037]">{my?.seat || 'ÂæÖÂÆö'} <span className="text-[#A69076] font-black ml-1 text-base leading-none">Ô∏ô</span></p></div>
                                                                    </div>
                                                                    <h3 className="text-[12px] font-bold border-b pb-2 mb-2 text-[#4A3728]">{tk.title}</h3>
                                                                    <div className="flex justify-between items-center text-[9px] font-bold text-[#A69076]">
                                                                        <p>{tk.date}</p>
                                                                        <Icon name="QrCode" size={14} className="opacity-40" />
                                                                    </div>
                                                                </div>
                                                            </>
                                                        ) : (
                                                            <div className="text-[#4A3728]">
                                                                <div className="flex justify-between items-start mb-2">
                                                                    <span className={`text-[7px] font-black uppercase px-2 py-0.5 rounded-sm ${tk.isJR ? 'bg-[#5D4037] text-white' : 'bg-[#EAE3D2] text-[#8E7D6A]'}`}>{tk.type}</span>
                                                                    <span className="text-[9px] font-bold text-[#A69076]">{tk.date}</span>
                                                                </div>
                                                                <p className="text-[13px] font-bold mb-1 leading-tight text-[#4A3728]">{tk.title}</p>
                                                                <div className="mt-4 flex justify-between items-end border-t border-dashed border-[#F3EFE0] pt-3 text-[#A69076]">
                                                                    <p className="text-[10px] font-black text-[#8B5E3C]">{activeTraveler.name} Â∞àÂ±¨ {my?.seat ? ` | ${my.seat}` : ''}</p>
                                                                    <span className="text-xl font-black text-[#5D4037] opacity-60">Ô∏ô</span>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                )}

                                {/* 3. Ë®òÂ∏≥ÂàÜÈ†Å */}
                                {currentTab === 'expenses' && (
                                    <div className="space-y-4 pb-12 px-1 pt-2 animate-fade-in text-[#4A3728]">
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                            {dates.map(d => (
                                                <button key={d.date} onClick={() => setSelectedAccDate(d.date)} className={`shrink-0 flex flex-col items-center justify-center w-12 h-14 rounded-2xl border transition-all ${selectedAccDate === d.date ? 'bg-[#5D4037] text-white shadow-lg' : 'bg-white text-[#8E7D6A]'}`}>
                                                    <span className="text-[6px] font-black uppercase">{d.weekday}</span>
                                                    <span className="text-sm font-bold">{d.date.split('/')[1]}</span>
                                                </button>
                                            ))}
                                        </div>
                                        <div className="bg-[#5D4037] p-6 rounded-[2.5rem] shadow-xl text-white text-center border border-white/5">
                                            <p className="text-[7px] font-black uppercase tracking-[0.4em] opacity-40 mb-1 text-center text-white">Cumulative Balance (¬•)</p>
                                            <h2 className="text-4xl font-bold tracking-tighter mb-6 text-white text-opacity-90">¬•{financeStats.cumulative.toLocaleString()}</h2>
                                            <div className="grid grid-cols-2 gap-4 border-t border-white/10 pt-4 px-2">
                                                <div className="text-left text-[#F5F2E9]"><p className="text-[7px] opacity-40 uppercase mb-1 font-black">Today Inc.</p><p className="text-sm font-bold text-green-300">¬•{financeStats.inc.toLocaleString()}</p></div>
                                                <div className="text-right border-l border-white/10 pl-4 text-stone-300"><p className="text-[7px] opacity-40 uppercase mb-1 font-black">Today Exp.</p><p className="text-sm font-bold text-red-300">¬•{financeStats.exp.toLocaleString()}</p></div>
                                            </div>
                                        </div>
                                        <div className="bg-white border p-5 rounded-[2rem] shadow-sm text-[#4A3728] border-[#EAE3D2]">
                                            <div className="flex gap-2 mb-4 bg-[#F3EFE0] p-1 rounded-xl text-[#4A3728]">
                                                <button onClick={() => setExpType('expense')} className={`flex-1 py-1.5 text-[9px] font-black rounded-lg transition-all ${expType === 'expense' ? 'bg-[#5D4037] text-white shadow-md' : ''}`}>ÊîØÂá∫</button>
                                                <button onClick={() => setExpType('income')} className={`flex-1 py-1.5 text-[9px] font-black rounded-lg transition-all ${expType === 'income' ? 'bg-[#D6C5A0] text-[#4A3728] shadow-md' : ''}`}>Êî∂ÂÖ•</button>
                                            </div>
                                            <div className="grid grid-cols-4 gap-2 mb-5">
                                               {Object.keys(accIcons).filter(k => expType === 'income' ? (k === 'Âü∫Èáë' || k === 'ÁΩ∞Ê¨æ') : (k !== 'Âü∫Èáë' && k !== 'ÁΩ∞Ê¨æ')).map(cat => (
                                                  <button key={cat} onClick={() => setExpCategory(cat)} className={`flex flex-col items-center gap-1.5 py-2 rounded-xl border transition-all ${expCategory === cat ? 'bg-[#F5F2E9] border-[#5D4037] text-[#5D4037]' : 'bg-white border-[#EEEAE0] text-[#A69076] opacity-60'}`}>
                                                     <span className="text-lg">{accIcons[cat]}</span><span className="text-[8px] font-black">{cat}</span>
                                                  </button>
                                               ))}
                                            </div>
                                            <form onSubmit={handleAddExpense} className="space-y-4">
                                                <input value={expRawAmount} onChange={e => setExpRawAmount(e.target.value)} placeholder="ÈáëÈ°ç (100+50)..." className="w-full bg-[#FAF9F6] border border-[#EAE3D2] rounded-xl text-[11px] px-4 py-3 outline-none focus:border-[#5D4037] font-mono shadow-inner text-[#4A3728]" />
                                                <div className="flex gap-2 text-[#4A3728]">
                                                    <input value={expDesc} onChange={e => setExpDesc(e.target.value)} placeholder="ÂÇôË®ª..." className="flex-1 bg-[#FAF9F6] border border-[#EAE3D2] rounded-xl text-[11px] px-4 py-3 outline-none focus:border-[#5D4037] shadow-inner text-[#4A3728]" />
                                                    <button type="submit" className="bg-[#5D4037] text-white px-5 rounded-xl shadow-lg active:scale-95 transition-all text-white font-bold text-lg">‚ú¢</button>
                                                </div>
                                            </form>
                                        </div>
                                        <div className="space-y-2 mt-4 text-[#4A3728]">
                                            {expenses.filter(e => e.date === selectedAccDate).map((exp) => (
                                                <div key={exp.id} className="flex items-center justify-between bg-white p-4 rounded-2xl shadow-xs border border-stone-100 group animate-fade-in text-[#4A3728]">
                                                    <div className="flex items-center gap-3 text-[#4A3728]">
                                                        <div className={`w-9 h-9 rounded-full flex items-center justify-center ${exp.type === 'income' ? 'bg-green-50' : 'bg-red-50'}`}>
                                                            <span className="text-lg">{accIcons[exp.category] || 'üí∞'}</span>
                                                        </div>
                                                        <div><p className="text-[12px] font-bold text-[#4A3728]">{exp.description}</p><p className="text-[8px] font-bold text-[#A69076] uppercase tracking-tighter">{exp.payer} ‚Ä¢ {exp.category}</p></div>
                                                    </div>
                                                    <div className="flex items-center gap-4 text-[#4A3728]">
                                                       <span className={`text-[13px] font-black ${exp.type === 'income' ? 'text-green-600' : 'text-[#5D4037]'}`}>¬•{exp.amount.toLocaleString()}</span>
                                                       <button onClick={() => deleteExpense(exp.id)} className="p-2 text-[#5D4037] opacity-20 hover:opacity-100 active:scale-90 transition-all font-bold text-lg text-[#4A3728]">‚úò</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* 4. ‰ΩèÂÆøÂàÜÈ†Å */}
                                {currentTab === 'stay' && (
                                    <div className="space-y-4 pb-10 px-1 pt-2 animate-fade-in text-[#4A3728]">
                                        {staysData.map((h, i) => (
                                            <div key={i} className="bg-white border border-[#EAE3D2] p-5 rounded-2xl shadow-sm text-[#4A3728]">
                                                <h4 className="font-black text-[13px] flex items-center gap-2 mb-1 uppercase tracking-tight text-[#5D4037]"><Icon name="Hotel" size={14} className="text-[#8B5E3C] opacity-80"/> {h.name}</h4>
                                                <p className="text-[9px] text-[#A68B6A] mb-4 font-bold tracking-widest">{h.period}</p>
                                                <div className="grid grid-cols-2 gap-3 mb-4 text-[#A69076]">
                                                    <div className="bg-[#FAF9F6] p-2 rounded-lg border border-[#EAE3D2] text-center text-[#A69076]">
                                                        <p className="text-[7px] font-black uppercase mb-1 text-[#A69076]">Check-In</p><p className="text-xs font-black text-[#5D4037]">{h.checkIn}</p>
                                                    </div>
                                                    <div className="bg-[#FAF9F6] p-2 rounded-lg border border-[#EAE3D2] text-center text-[#A69076]">
                                                        <p className="text-[7px] font-black uppercase mb-1 text-[#A69076]">Check-Out</p><p className="text-xs font-black text-[#5D4037]">{h.checkOut}</p>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 text-[#4A3728] text-[10px] font-bold">
                                                    <div className="flex items-center gap-2 opacity-70"><Icon name="MapPin" size={10} className="text-[#8B5E3C]"/> {h.distance}</div>
                                                    <div className="flex items-center gap-2 opacity-70"><Icon name="Package" size={10} className="text-[#8B5E3C]"/> Ë°åÊùéÔºö{h.luggage}</div>
                                                    <div className="flex items-center gap-2 opacity-70"><Icon name="ShoppingBag" size={10} className="text-[#8B5E3C]"/> ÈôÑËøëÔºö{h.nearby}</div>
                                                    <p className="bg-[#F5F2E9]/50 p-2 rounded border-l-2 border-[#D6C5A0] opacity-70 italic text-[9px] leading-relaxed font-medium">‚ö†Ô∏è {h.note}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* 5. Ë≥ºÁâ©ÂàÜÈ†Å */}
                                {currentTab === 'shopping' && (
                                    <div className="animate-fade-in pt-2 text-[#4A3728]">
                                        <div className="bg-white border border-[#EAE3D2] shadow-sm rounded-3xl min-h-[480px] flex flex-col overflow-hidden text-[#4A3728]">
                                            <div className="grid grid-cols-5 gap-0.5 p-1 bg-[#F3EFE0] border-b text-[#4A3728]">
                                                {['Ë∂ÖÂ∏Ç', 'Ë∂ÖÂïÜ', 'ÂîêÂêâ', 'ÁæéÂ¶ù', 'ÂÑ™ÊÉ†Âà∏'].map(cat => (
                                                    <button key={cat} onClick={() => setActiveShopCategory(cat)} className={`py-1.5 text-[9px] font-black rounded transition-all ${activeShopCategory === cat ? 'bg-[#5D4037] text-white shadow-md' : 'text-[#8B5E3C]'}`}>{cat}</button>
                                                ))}
                                            </div>
                                            <div className="p-6 flex-1 flex flex-col">
                                                {activeShopCategory === 'ÂÑ™ÊÉ†Âà∏' ? (
                                                    <div className="grid grid-cols-2 gap-3 pb-10 px-1 text-[#4A3728]">
                                                        {couponData.map(cp => (
                                                            <button key={cp.id} onClick={() => setSelectedOverlay(cp)} className="bg-[#FAF9F6] border border-[#EAE3D2] rounded-xl overflow-hidden shadow-sm active:scale-95 text-left transition-all">
                                                                <div className="h-20 bg-stone-200 relative overflow-hidden"><img src={cp.img} className="w-full h-full object-cover opacity-80" alt="" /><Icon name="Image" size={14} className="absolute top-2 right-2 opacity-30 text-white" /></div>
                                                                <div className="p-2 font-black text-[10px] text-[#4A3728]"><p className="mb-0.5 text-[#4A3728]">{cp.name}</p><p className="text-red-500 font-bold text-[8px]">{cp.discount}</p></div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                ) : (
                                                    <div className="flex-1 flex flex-col text-[#4A3728]">
                                                        <h2 className="text-xs font-bold mb-6 flex items-center gap-2 tracking-widest uppercase font-black text-[#4A3728]"><Icon name="ShoppingBag" size={14}/> {activeTraveler.name} ÁöÑÊ∏ÖÂñÆ</h2>
                                                        <div className="flex-1 space-y-2 overflow-y-auto max-h-[250px] no-scrollbar text-[#4A3728]">
                                                            {shoppingItems.filter(item => item.travelerId === activeTraveler.id && item.category === activeShopCategory).sort((a, b) => (a.purchased === b.purchased ? 0 : a.purchased ? 1 : -1)).map(item => (
                                                                <div key={item.id} className="flex items-center justify-between p-2 border-b border-[#EEEAE0]/40 group transition-all text-[#4A3728]">
                                                                    <button onClick={() => togglePurchased(item)} className="flex-1 flex items-center gap-3 text-left text-[#4A3728]">
                                                                        <div className={`w-5 h-5 border-2 border-[#D6C5A0] rounded flex items-center justify-center transition-all ${item.purchased ? 'bg-[#5D4037] border-[#5D4037]' : 'bg-white'}`}>
                                                                            {item.purchased && <span className="text-white text-[10px] font-black">‚úì</span>}
                                                                        </div>
                                                                        <span className={`text-[13px] font-bold transition-all ${item.purchased ? 'line-through opacity-30 italic text-[#8E7D6A]' : 'text-[#4A3728]'}`}>{item.name}</span>
                                                                    </button>
                                                                    <button onClick={() => deleteShopItem(item.id)} className="p-2 text-[#5D4037] opacity-20 hover:opacity-100 active:scale-90 transition-all font-bold text-lg text-[#4A3728]">‚úò</button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        <form onSubmit={handleAddShopItem} className="mt-6 flex gap-2 border-t border-[#F3EFE0] pt-4">
                                                            <input value={newShopItemName} onChange={e => setNewShopItemName(e.target.value)} placeholder={`Êñ∞Â¢ûËá≥ ${activeTraveler.name} Ê∏ÖÂñÆ...`} className="flex-1 bg-[#F9F8F6] border border-[#EAE3D2] px-3 py-2 text-[11px] rounded-xl outline-none text-[#4A3728]" />
                                                            <button type="submit" className="bg-[#5D4037] text-white px-4 rounded-xl shadow-md active:scale-95 transition-all text-white font-bold text-lg">‚ú¢</button>
                                                        </form>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </main>
                        </div>

                        {/* --- Â∫ïÈÉ®Â∞éË¶ΩÂàó --- */}
                        <nav className="fixed-nav text-[#4A3728]">
                            <button onClick={() => setCurrentTab('itinerary')} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${currentTab === 'itinerary' ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                                <Icon name="Layout" size={18} className={`transition-transform duration-300 ${currentTab === 'itinerary' ? 'scale-150' : 'scale-100 opacity-70'}`} />
                                <span className="text-[8px] font-bold uppercase mt-0.5">Ë°åÁ®ã</span>
                            </button>
                            <button onClick={() => setCurrentTab('tickets')} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${currentTab === 'tickets' ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                                <Icon name="Ticket" size={18} className={`transition-transform duration-300 ${currentTab === 'tickets' ? 'scale-150' : 'scale-100 opacity-70'}`} />
                                <span className="text-[8px] font-bold uppercase mt-0.5">Á•®Âà∏</span>
                            </button>
                            <button onClick={() => setCurrentTab('expenses')} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${currentTab === 'expenses' ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                                <Icon name="Wallet" size={18} className={`transition-transform duration-300 ${currentTab === 'expenses' ? 'scale-150' : 'scale-100 opacity-70'}`} />
                                <span className="text-[8px] font-bold uppercase mt-0.5">Ë®òÂ∏≥</span>
                            </button>
                            <button onClick={() => setCurrentTab('stay')} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${currentTab === 'stay' ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                                <Icon name="Hotel" size={18} className={`transition-transform duration-300 ${currentTab === 'stay' ? 'scale-150' : 'scale-100 opacity-70'}`} />
                                <span className="text-[8px] font-bold uppercase mt-0.5">‰ΩèÂÆø</span>
                            </button>
                            <button onClick={() => setCurrentTab('shopping')} className={`flex-1 flex flex-col items-center justify-center transition-all duration-300 ${currentTab === 'shopping' ? 'bg-[#5D4037] text-[#FAF9F6]' : 'text-[#8E7D6A]'}`}>
                                <Icon name="ShoppingBag" size={18} className={`transition-transform duration-300 ${currentTab === 'shopping' ? 'scale-150' : 'scale-100 opacity-70'}`} />
                                <span className="text-[8px] font-bold uppercase mt-0.5">Ë≥ºÁâ©</span>
                            </button>
                        </nav>
                        
                        {/* Overlay ÂΩàÁ™ó */}
                        {selectedOverlay && (
                            <div className="fixed inset-0 z-[100] overlay-backdrop flex flex-col items-center justify-center p-6 animate-fade-in text-[#4A3728]" onClick={closeOverlay}>
                                <div className="w-full max-w-[340px] pointer-events-auto" onClick={(e) => e.stopPropagation()}>
                                    <div className="bg-[#FAF9F6] p-6 rounded-[2.5rem] shadow-2xl relative overflow-hidden border border-[#EAE3D2] text-[#4A3728]" onClick={closeOverlay}>
                                        <div className="absolute inset-0 pointer-events-none opacity-[0.03] dot-grid"></div>
                                        <div className="flex justify-between items-center mb-5 border-b border-[#EAE3D2] pb-4 px-1 relative z-20 text-[#4A3728]">
                                            <div className="text-left flex-1 text-[#4A3728]"><h3 className="font-black text-lg leading-tight text-[#4A3728]">{selectedOverlay.name || selectedOverlay.title}</h3><p className="text-[7px] font-bold text-[#A69076] mt-0.5 uppercase tracking-widest">{selectedOverlay.assignments ? activeTraveler.name + ' Â∞àÂ±¨' : 'Ë°åÁ®ãÊòéÁ¥∞'}</p></div>
                                            <button onClick={() => setSelectedOverlay(null)} className="text-[#8B5E3C] p-2 hover:bg-stone-100 rounded-full transition-colors relative z-30 font-bold text-xl text-[#5D4037]">√ó</button>
                                        </div>
                                        <div className="bg-white rounded-[2rem] overflow-hidden border border-dashed border-[#D6C5A0] flex flex-col items-center justify-center min-h-[350px] p-2 shadow-inner text-[#4A3728] relative z-20">
                                            {selectedOverlay.currentImg ? (
                                                <div className="w-full h-full flex flex-col items-center justify-center overflow-hidden"><img src={selectedOverlay.currentImg} className="max-w-full max-h-[320px] object-contain rounded-xl" /><button onClick={() => window.open(selectedOverlay.currentImg)} className="mt-4 text-[10px] font-black underline text-[#5D4037]">Âú®Êñ∞ÂàÜÈ†ÅÈñãÂïü</button></div>
                                            ) : selectedOverlay.isVJW ? (
                                                <div className="p-6 w-full flex flex-col items-center text-center">
                                                    <div className="bg-orange-50 p-5 rounded-full mb-6 text-orange-400 font-bold text-4xl">‚ú¢</div>
                                                    <h4 className="text-sm font-black mb-2 uppercase text-[#4A3728]">Visit Japan Web</h4>
                                                    <div className="p-3 bg-[#F9F8F6] rounded-xl border border-[#EAE3D2] w-full mb-6 text-[#4A3728]">
                                                        <p className="text-[7px] font-black text-[#A69076] uppercase mb-1 text-center text-[#A69076]">‰πòÂÆ¢È†êË®ÇÁ∑®Ëôü</p>
                                                        <p className="text-lg font-black text-[#5D4037] tracking-widest text-center text-[#5D4037]">{selectedOverlay.assignments[activeTraveler.id].code}</p>
                                                    </div>
                                                    <button onClick={(e) => { e.stopPropagation(); window.open(selectedOverlay.vjwLink); }} className="w-full bg-[#5D4037] text-white py-4 rounded-2xl font-black text-[11px] shadow-xl hover:bg-[#4A3728] transition-all active:scale-95 text-white">Á´ãÂç≥ÂâçÂæÄ</button>
                                                </div>
                                            ) : selectedOverlay.isJR ? (
                                                <div className="p-4 w-full text-left text-[#4A3728]">
                                                    <p className="text-[7px] font-black text-[#8E7D6A] uppercase mb-1.5 tracking-widest opacity-60 text-[#A69076]">Reservation Details</p>
                                                    <p className="text-lg font-black text-[#5D4037] mb-2 text-[#5D4037]">{selectedOverlay.details.no}</p>
                                                    <p className="text-[10px] font-bold opacity-60 text-[#4A3728]">{selectedOverlay.details.notice}</p>
                                                </div>
                                            ) : (
                                                <div className="text-center opacity-10 text-[#4A3728] font-bold text-4xl">VOID</div>
                                            )}
                                        </div>
                                        <p className="text-[7px] text-center mt-6 opacity-40 font-bold tracking-[0.2em] italic text-[#5D4037] relative z-20">ÈªûÊìäÂúñÁâáÊàñËÉåÊôØÂç≥ÂèØËøîÂõû</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = window.ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>